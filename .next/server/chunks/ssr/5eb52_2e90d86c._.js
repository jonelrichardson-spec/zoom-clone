module.exports=[48752,(a,b,c)=>{"use strict";let d={};d.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(a=>a.trim())},d.splitSections=function(a){return a.split("\nm=").map((a,b)=>(b>0?"m="+a:a).trim()+"\r\n")},d.getDescription=function(a){let b=d.splitSections(a);return b&&b[0]},d.getMediaSections=function(a){let b=d.splitSections(a);return b.shift(),b},d.matchPrefix=function(a,b){return d.splitLines(a).filter(a=>0===a.indexOf(b))},d.parseCandidate=function(a){let b,c={foundation:(b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[b[1]]||b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],address:b[4],port:parseInt(b[5],10),type:b[7]};for(let a=8;a<b.length;a+=2)switch(b[a]){case"raddr":c.relatedAddress=b[a+1];break;case"rport":c.relatedPort=parseInt(b[a+1],10);break;case"tcptype":c.tcpType=b[a+1];break;case"ufrag":c.ufrag=b[a+1],c.usernameFragment=b[a+1];break;default:void 0===c[b[a]]&&(c[b[a]]=b[a+1])}return c},d.writeCandidate=function(a){let b=[];b.push(a.foundation);let c=a.component;"rtp"===c?b.push(1):"rtcp"===c?b.push(2):b.push(c),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.address||a.ip),b.push(a.port);let d=a.type;return b.push("typ"),b.push(d),"host"!==d&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},d.parseIceOptions=function(a){return a.substring(14).split(" ")},d.parseRtpMap=function(a){let b=a.substring(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return c.name=(b=b[0].split("/"))[0],c.clockRate=parseInt(b[1],10),c.channels=3===b.length?parseInt(b[2],10):1,c.numChannels=c.channels,c},d.writeRtpMap=function(a){let b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);let c=a.channels||a.numChannels||1;return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==c?"/"+c:"")+"\r\n"},d.parseExtmap=function(a){let b=a.substring(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1],attributes:b.slice(2).join(" ")}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+(a.attributes?" "+a.attributes:"")+"\r\n"},d.parseFmtp=function(a){let b,c={},d=a.substring(a.indexOf(" ")+1).split(";");for(let a=0;a<d.length;a++)c[(b=d[a].trim().split("="))[0].trim()]=b[1];return c},d.writeFmtp=function(a){let b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){let d=[];Object.keys(a.parameters).forEach(b=>{void 0!==a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){let b=a.substring(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){let b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(a=>{b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){let b=a.indexOf(" "),c={ssrc:parseInt(a.substring(7,b),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substring(b+1,d),c.value=a.substring(d+1)):c.attribute=a.substring(b+1),c},d.parseSsrcGroup=function(a){let b=a.substring(13).split(" ");return{semantics:b.shift(),ssrcs:b.map(a=>parseInt(a,10))}},d.getMid=function(a){let b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substring(6)},d.parseFingerprint=function(a){let b=a.substring(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1].toUpperCase()}},d.getDtlsParameters=function(a,b){return{role:"auto",fingerprints:d.matchPrefix(a+b,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,b){let c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(a=>{c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.parseCryptoLine=function(a){let b=a.substring(9).split(" ");return{tag:parseInt(b[0],10),cryptoSuite:b[1],keyParams:b[2],sessionParams:b.slice(3)}},d.writeCryptoLine=function(a){return"a=crypto:"+a.tag+" "+a.cryptoSuite+" "+("object"==typeof a.keyParams?d.writeCryptoKeyParams(a.keyParams):a.keyParams)+(a.sessionParams?" "+a.sessionParams.join(" "):"")+"\r\n"},d.parseCryptoKeyParams=function(a){if(0!==a.indexOf("inline:"))return null;let b=a.substring(7).split("|");return{keyMethod:"inline",keySalt:b[0],lifeTime:b[1],mkiValue:b[2]?b[2].split(":")[0]:void 0,mkiLength:b[2]?b[2].split(":")[1]:void 0}},d.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},d.getCryptoParameters=function(a,b){return d.matchPrefix(a+b,"a=crypto:").map(d.parseCryptoLine)},d.getIceParameters=function(a,b){let c=d.matchPrefix(a+b,"a=ice-ufrag:")[0],e=d.matchPrefix(a+b,"a=ice-pwd:")[0];return c&&e?{usernameFragment:c.substring(12),password:e.substring(10)}:null},d.writeIceParameters=function(a){let b="a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n";return a.iceLite&&(b+="a=ice-lite\r\n"),b},d.parseRtpParameters=function(a){let b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a)[0].split(" ");b.profile=c[2];for(let e=3;e<c.length;e++){let f=c[e],g=d.matchPrefix(a,"a=rtpmap:"+f+" ")[0];if(g){let c=d.parseRtpMap(g),e=d.matchPrefix(a,"a=fmtp:"+f+" ");switch(c.parameters=e.length?d.parseFmtp(e[0]):{},c.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+f+" ").map(d.parseRtcpFb),b.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(c.name.toUpperCase())}}}d.matchPrefix(a,"a=extmap:").forEach(a=>{b.headerExtensions.push(d.parseExtmap(a))});let e=d.matchPrefix(a,"a=rtcp-fb:* ").map(d.parseRtcpFb);return b.codecs.forEach(a=>{e.forEach(b=>{a.rtcpFeedback.find(a=>a.type===b.type&&a.parameter===b.parameter)||a.rtcpFeedback.push(b)})}),b},d.writeRtpDescription=function(a,b){let c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" "+(b.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=b.codecs.map(a=>void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(a=>{c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});let e=0;return b.codecs.forEach(a=>{a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),b.headerExtensions&&b.headerExtensions.forEach(a=>{c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){let b,c=[],e=d.parseRtpParameters(a),f=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),h=d.matchPrefix(a,"a=ssrc:").map(a=>d.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(a=>a.substring(17).split(" ").map(a=>parseInt(a,10)));j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(a=>{if("RTX"===a.name.toUpperCase()&&a.parameters.apt){let d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10)};i&&b&&(d.rtx={ssrc:b}),c.push(d),f&&((d=JSON.parse(JSON.stringify(d))).fec={ssrc:i,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});let k=d.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substring(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substring(5),10)*.95-16e3:void 0,c.forEach(a=>{a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){let b={},c=d.matchPrefix(a,"a=ssrc:").map(a=>d.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute)[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);let e=d.matchPrefix(a,"a=rtcp-rsize");return b.reducedSize=e.length>0,b.compound=0===e.length,b.mux=d.matchPrefix(a,"a=rtcp-mux").length>0,b},d.writeRtcpParameters=function(a){let b="";return a.reducedSize&&(b+="a=rtcp-rsize\r\n"),a.mux&&(b+="a=rtcp-mux\r\n"),void 0!==a.ssrc&&a.cname&&(b+="a=ssrc:"+a.ssrc+" cname:"+a.cname+"\r\n"),b},d.parseMsid=function(a){let b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return{stream:(b=c[0].substring(7).split(" "))[0],track:b[1]};let e=d.matchPrefix(a,"a=ssrc:").map(a=>d.parseSsrcMedia(a)).filter(a=>"msid"===a.attribute);if(e.length>0)return{stream:(b=e[0].value.split(" "))[0],track:b[1]}},d.parseSctpDescription=function(a){let b,c=d.parseMLine(a),e=d.matchPrefix(a,"a=max-message-size:");e.length>0&&(b=parseInt(e[0].substring(19),10)),isNaN(b)&&(b=65536);let f=d.matchPrefix(a,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:c.fmt,maxMessageSize:b};let g=d.matchPrefix(a,"a=sctpmap:");if(g.length>0){let a=g[0].substring(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:b}}},d.writeSctpDescription=function(a,b){let c=[];return c="DTLS/SCTP"!==a.protocol?["m="+a.kind+" 9 "+a.protocol+" "+b.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+b.port+"\r\n"]:["m="+a.kind+" 9 "+a.protocol+" "+b.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+b.port+" "+b.protocol+" 65535\r\n"],void 0!==b.maxMessageSize&&c.push("a=max-message-size:"+b.maxMessageSize+"\r\n"),c.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,22)},d.writeSessionBoilerplate=function(a,b,c){return"v=0\r\no="+(c||"thisisadapterortc")+" "+(a||d.generateSessionId())+" "+(void 0!==b?b:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.getDirection=function(a,b){let c=d.splitLines(a);for(let a=0;a<c.length;a++)switch(c[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[a].substring(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){return d.splitLines(a)[0].split(" ")[0].substring(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},d.parseMLine=function(a){let b=d.splitLines(a)[0].substring(2).split(" ");return{kind:b[0],port:parseInt(b[1],10),protocol:b[2],fmt:b.slice(3).join(" ")}},d.parseOLine=function(a){let b=d.matchPrefix(a,"o=")[0].substring(2).split(" ");return{username:b[0],sessionId:b[1],sessionVersion:parseInt(b[2],10),netType:b[3],addressType:b[4],address:b[5]}},d.isValidSDP=function(a){if("string"!=typeof a||0===a.length)return!1;let b=d.splitLines(a);for(let a=0;a<b.length;a++)if(b[a].length<2||"="!==b[a].charAt(1))return!1;return!0},b.exports=d},36281,a=>{"use strict";class b{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(a){this.flush(),this._parts.push(a)}append(a){this._pieces.push(a)}flush(){if(this._pieces.length>0){let a=new Uint8Array(this._pieces);this._parts.push(a),this._pieces=[]}}toArrayBuffer(){let a=[];for(let b of this._parts)a.push(b);return function(a){let b=0;for(let c of a)b+=c.byteLength;let c=new Uint8Array(b),d=0;for(let b of a){let a=new Uint8Array(b.buffer,b.byteOffset,b.byteLength);c.set(a,d),d+=b.byteLength}return c}(a).buffer}}function c(a){return new e(a).unpack()}function d(a){let b=new f,c=b.pack(a);return c instanceof Promise?c.then(()=>b.getBuffer()):b.getBuffer()}class e{constructor(a){this.index=0,this.dataBuffer=a,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){let a,b=this.unpack_uint8();if(b<128)return b;if((224^b)<32)return(224^b)-32;if((a=160^b)<=15)return this.unpack_raw(a);if((a=176^b)<=15)return this.unpack_string(a);if((a=144^b)<=15)return this.unpack_array(a);if((a=128^b)<=15)return this.unpack_map(a);switch(b){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return a=this.unpack_uint16(),this.unpack_string(a);case 217:return a=this.unpack_uint32(),this.unpack_string(a);case 218:return a=this.unpack_uint16(),this.unpack_raw(a);case 219:return a=this.unpack_uint32(),this.unpack_raw(a);case 220:return a=this.unpack_uint16(),this.unpack_array(a);case 221:return a=this.unpack_uint32(),this.unpack_array(a);case 222:return a=this.unpack_uint16(),this.unpack_map(a);case 223:return a=this.unpack_uint32(),this.unpack_map(a)}}unpack_uint8(){let a=255&this.dataView[this.index];return this.index++,a}unpack_uint16(){let a=this.read(2),b=(255&a[0])*256+(255&a[1]);return this.index+=2,b}unpack_uint32(){let a=this.read(4),b=((256*a[0]+a[1])*256+a[2])*256+a[3];return this.index+=4,b}unpack_uint64(){let a=this.read(8),b=((((((256*a[0]+a[1])*256+a[2])*256+a[3])*256+a[4])*256+a[5])*256+a[6])*256+a[7];return this.index+=8,b}unpack_int8(){let a=this.unpack_uint8();return a<128?a:a-256}unpack_int16(){let a=this.unpack_uint16();return a<32768?a:a-65536}unpack_int32(){let a=this.unpack_uint32();return a<0x80000000?a:a-0x100000000}unpack_int64(){let a=this.unpack_uint64();return a<0x8000000000000000?a:a-0xffffffffffffffff}unpack_raw(a){if(this.length<this.index+a)throw Error(`BinaryPackFailure: index is out of range ${this.index} ${a} ${this.length}`);let b=this.dataBuffer.slice(this.index,this.index+a);return this.index+=a,b}unpack_string(a){let b,c,d=this.read(a),e=0,f="";for(;e<a;)(b=d[e])<160?(c=b,e++):(192^b)<32?(c=(31&b)<<6|63&d[e+1],e+=2):(224^b)<16?(c=(15&b)<<12|(63&d[e+1])<<6|63&d[e+2],e+=3):(c=(7&b)<<18|(63&d[e+1])<<12|(63&d[e+2])<<6|63&d[e+3],e+=4),f+=String.fromCodePoint(c);return this.index+=a,f}unpack_array(a){let b=Array(a);for(let c=0;c<a;c++)b[c]=this.unpack();return b}unpack_map(a){let b={};for(let c=0;c<a;c++)b[this.unpack()]=this.unpack();return b}unpack_float(){let a=this.unpack_uint32();return(0==a>>31?1:-1)*(8388607&a|8388608)*2**((a>>23&255)-127-23)}unpack_double(){let a=this.unpack_uint32(),b=this.unpack_uint32(),c=(a>>20&2047)-1023;return(0==a>>31?1:-1)*((1048575&a|1048576)*2**(c-20)+b*2**(c-52))}read(a){let b=this.index;if(b+a<=this.length)return this.dataView.subarray(b,b+a);throw Error("BinaryPackFailure: read index out of range")}}class f{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(a){if("string"==typeof a)this.pack_string(a);else if("number"==typeof a)Math.floor(a)===a?this.pack_integer(a):this.pack_double(a);else if("boolean"==typeof a)!0===a?this._bufferBuilder.append(195):!1===a&&this._bufferBuilder.append(194);else if(void 0===a)this._bufferBuilder.append(192);else if("object"==typeof a)if(null===a)this._bufferBuilder.append(192);else{let b=a.constructor;if(a instanceof Array){let b=this.pack_array(a);if(b instanceof Promise)return b.then(()=>this._bufferBuilder.flush())}else if(a instanceof ArrayBuffer)this.pack_bin(new Uint8Array(a));else if("BYTES_PER_ELEMENT"in a)this.pack_bin(new Uint8Array(a.buffer,a.byteOffset,a.byteLength));else if(a instanceof Date)this.pack_string(a.toString());else if(a instanceof Blob)return a.arrayBuffer().then(a=>{this.pack_bin(new Uint8Array(a)),this._bufferBuilder.flush()});else if(b==Object||b.toString().startsWith("class")){let b=this.pack_object(a);if(b instanceof Promise)return b.then(()=>this._bufferBuilder.flush())}else throw Error(`Type "${b.toString()}" not yet supported`)}else throw Error(`Type "${typeof a}" not yet supported`);this._bufferBuilder.flush()}pack_bin(a){let b=a.length;if(b<=15)this.pack_uint8(160+b);else if(b<=65535)this._bufferBuilder.append(218),this.pack_uint16(b);else if(b<=0xffffffff)this._bufferBuilder.append(219),this.pack_uint32(b);else throw Error("Invalid length");this._bufferBuilder.append_buffer(a)}pack_string(a){let b=this._textEncoder.encode(a),c=b.length;if(c<=15)this.pack_uint8(176+c);else if(c<=65535)this._bufferBuilder.append(216),this.pack_uint16(c);else if(c<=0xffffffff)this._bufferBuilder.append(217),this.pack_uint32(c);else throw Error("Invalid length");this._bufferBuilder.append_buffer(b)}pack_array(a){let b=a.length;if(b<=15)this.pack_uint8(144+b);else if(b<=65535)this._bufferBuilder.append(220),this.pack_uint16(b);else if(b<=0xffffffff)this._bufferBuilder.append(221),this.pack_uint32(b);else throw Error("Invalid length");let c=d=>{if(d<b){let b=this.pack(a[d]);return b instanceof Promise?b.then(()=>c(d+1)):c(d+1)}};return c(0)}pack_integer(a){if(a>=-32&&a<=127)this._bufferBuilder.append(255&a);else if(a>=0&&a<=255)this._bufferBuilder.append(204),this.pack_uint8(a);else if(a>=-128&&a<=127)this._bufferBuilder.append(208),this.pack_int8(a);else if(a>=0&&a<=65535)this._bufferBuilder.append(205),this.pack_uint16(a);else if(a>=-32768&&a<=32767)this._bufferBuilder.append(209),this.pack_int16(a);else if(a>=0&&a<=0xffffffff)this._bufferBuilder.append(206),this.pack_uint32(a);else if(a>=-0x80000000&&a<=0x7fffffff)this._bufferBuilder.append(210),this.pack_int32(a);else if(a>=-0x8000000000000000&&a<=0x8000000000000000)this._bufferBuilder.append(211),this.pack_int64(a);else if(a>=0&&a<=0xffffffffffffffff)this._bufferBuilder.append(207),this.pack_uint64(a);else throw Error("Invalid integer")}pack_double(a){let b=0;a<0&&(b=1,a=-a);let c=Math.floor(Math.log(a)/Math.LN2),d=Math.floor((a/2**c-1)*0x10000000000000),e=b<<31|c+1023<<20|d/0x100000000&1048575;this._bufferBuilder.append(203),this.pack_int32(e),this.pack_int32(d%0x100000000)}pack_object(a){let b=Object.keys(a),c=b.length;if(c<=15)this.pack_uint8(128+c);else if(c<=65535)this._bufferBuilder.append(222),this.pack_uint16(c);else if(c<=0xffffffff)this._bufferBuilder.append(223),this.pack_uint32(c);else throw Error("Invalid length");let d=c=>{if(c<b.length){let e=b[c];if(a.hasOwnProperty(e)){this.pack(e);let b=this.pack(a[e]);if(b instanceof Promise)return b.then(()=>d(c+1))}return d(c+1)}};return d(0)}pack_uint8(a){this._bufferBuilder.append(a)}pack_uint16(a){this._bufferBuilder.append(a>>8),this._bufferBuilder.append(255&a)}pack_uint32(a){let b=0|a;this._bufferBuilder.append((0xff000000&b)>>>24),this._bufferBuilder.append((0xff0000&b)>>>16),this._bufferBuilder.append((65280&b)>>>8),this._bufferBuilder.append(255&b)}pack_uint64(a){let b=a/0x100000000,c=a%0x100000000;this._bufferBuilder.append((0xff000000&b)>>>24),this._bufferBuilder.append((0xff0000&b)>>>16),this._bufferBuilder.append((65280&b)>>>8),this._bufferBuilder.append(255&b),this._bufferBuilder.append((0xff000000&c)>>>24),this._bufferBuilder.append((0xff0000&c)>>>16),this._bufferBuilder.append((65280&c)>>>8),this._bufferBuilder.append(255&c)}pack_int8(a){this._bufferBuilder.append(255&a)}pack_int16(a){this._bufferBuilder.append((65280&a)>>8),this._bufferBuilder.append(255&a)}pack_int32(a){this._bufferBuilder.append(a>>>24&255),this._bufferBuilder.append((0xff0000&a)>>>16),this._bufferBuilder.append((65280&a)>>>8),this._bufferBuilder.append(255&a)}pack_int64(a){let b=Math.floor(a/0x100000000),c=a%0x100000000;this._bufferBuilder.append((0xff000000&b)>>>24),this._bufferBuilder.append((0xff0000&b)>>>16),this._bufferBuilder.append((65280&b)>>>8),this._bufferBuilder.append(255&b),this._bufferBuilder.append((0xff000000&c)>>>24),this._bufferBuilder.append((0xff0000&c)>>>16),this._bufferBuilder.append((65280&c)>>>8),this._bufferBuilder.append(255&c)}constructor(){this._bufferBuilder=new b,this._textEncoder=new TextEncoder}}let g=!0;function h(a,b,c){let d=a.match(b);return d&&d.length>=c&&parseFloat(d[c],10)}function i(a,b,c){if(!a.RTCPeerConnection)return;let d=a.RTCPeerConnection.prototype,e=d.addEventListener;d.addEventListener=function(a,d){if(a!==b)return e.apply(this,arguments);let f=a=>{let b=c(a);b&&(d.handleEvent?d.handleEvent(b):d(b))};return this._eventMap=this._eventMap||{},this._eventMap[b]||(this._eventMap[b]=new Map),this._eventMap[b].set(d,f),e.apply(this,[a,f])};let f=d.removeEventListener;d.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[b]||!this._eventMap[b].has(c))return f.apply(this,arguments);let d=this._eventMap[b].get(c);return this._eventMap[b].delete(c),0===this._eventMap[b].size&&delete this._eventMap[b],0===Object.keys(this._eventMap).length&&delete this._eventMap,f.apply(this,[a,d])},Object.defineProperty(d,"on"+b,{get(){return this["_on"+b]},set(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}function j(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):a?"adapter.js logging disabled":"adapter.js logging enabled"}function k(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(g=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))}function l(){}function m(a,b){g&&console.warn(a+" is deprecated, please use "+b+" instead.")}function n(a){return"[object Object]"===Object.prototype.toString.call(a)}function o(a,b,c){let d=c?"outbound-rtp":"inbound-rtp",e=new Map;if(null===b)return e;let f=[];return a.forEach(a=>{"track"===a.type&&a.trackIdentifier===b.id&&f.push(a)}),f.forEach(b=>{a.forEach(c=>{c.type===d&&c.trackId===b.id&&function a(b,c,d){!c||d.has(c.id)||(d.set(c.id,c),Object.keys(c).forEach(e=>{e.endsWith("Id")?a(b,b.get(c[e]),d):e.endsWith("Ids")&&c[e].forEach(c=>{a(b,b.get(c),d)})}))}(a,c,e)})}),e}function p(a,b){let c=a&&a.navigator;if(!c.mediaDevices)return;let d=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;let b={};return Object.keys(a).forEach(c=>{if("require"===c||"advanced"===c||"mediaSource"===c)return;let d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);let e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];let a={};"number"==typeof d.ideal?(a[e("min",c)]=d.ideal,b.optional.push(a),(a={})[e("max",c)]=d.ideal):a[e("",c)]=d.ideal,b.optional.push(a)}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(a=>{void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},e=function(a,e){if(b.version>=61)return e(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"==typeof a.audio){let b=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};b((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),b(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=d(a.audio)}if(a&&"object"==typeof a.video){let f=a.video.facingMode;f=f&&("object"==typeof f?f:{ideal:f});let g=b.version<66;if(f&&("user"===f.exact||"environment"===f.exact||"user"===f.ideal||"environment"===f.ideal)&&!(c.mediaDevices.getSupportedConstraints&&c.mediaDevices.getSupportedConstraints().facingMode&&!g)){let b;if(delete a.video.facingMode,"environment"===f.exact||"environment"===f.ideal?b=["back","rear"]:("user"===f.exact||"user"===f.ideal)&&(b=["front"]),b)return c.mediaDevices.enumerateDevices().then(c=>{let g=(c=c.filter(a=>"videoinput"===a.kind)).find(a=>b.some(b=>a.label.toLowerCase().includes(b)));return!g&&c.length&&b.includes("back")&&(g=c[c.length-1]),g&&(a.video.deviceId=f.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=d(a.video),l("chrome: "+JSON.stringify(a)),e(a)})}a.video=d(a.video)}return l("chrome: "+JSON.stringify(a)),e(a)},f=function(a){return b.version>=64?a:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(c.getUserMedia=(function(a,b,d){e(a,a=>{c.webkitGetUserMedia(a,b,a=>{d&&d(f(a))})})}).bind(c),c.mediaDevices.getUserMedia){let a=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(b){return e(b,b=>a(b).then(a=>{if(b.audio&&!a.getAudioTracks().length||b.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return a},a=>Promise.reject(f(a))))}}}function q(a){a.MediaStream=a.MediaStream||a.webkitMediaStream}function r(a){if("object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)i(a,"track",a=>(a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a));else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});let b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=b=>{b.stream.addEventListener("addtrack",c=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===c.track.id):{track:c.track};let e=new Event("track");e.track=c.track,e.receiver=d,e.transceiver={receiver:d},e.streams=[b.stream],this.dispatchEvent(e)}),b.stream.getTracks().forEach(c=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===c.id):{track:c};let e=new Event("track");e.track=c,e.receiver=d,e.transceiver={receiver:d},e.streams=[b.stream],this.dispatchEvent(e)})},this.addEventListener("addstream",this._ontrackpoly)),b.apply(this,arguments)}}}function s(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){let b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){let e=c.apply(this,arguments);return e||(e=b(this,a),this._senders.push(e)),e};let d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){d.apply(this,arguments);let b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}let c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],c.apply(this,[a]),a.getTracks().forEach(a=>{this._senders.push(b(this,a))})};let d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],d.apply(this,[a]),a.getTracks().forEach(a=>{let b=this._senders.find(b=>b.track===a);b&&this._senders.splice(this._senders.indexOf(b),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){let b=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function t(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver))return;if(!("getStats"in a.RTCRtpSender.prototype)){let b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a});let c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){let a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){let a=this;return this._pc.getStats().then(b=>o(b,a.track,!0))}}if(!("getStats"in a.RTCRtpReceiver.prototype)){let b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a}),i(a,"track",a=>(a.receiver._pc=a.srcElement,a)),a.RTCRtpReceiver.prototype.getStats=function(){let a=this;return this._pc.getStats().then(b=>o(b,a.track,!1))}}if(!("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype))return;let b=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof a.MediaStreamTrack){let a,b,c,d=arguments[0];return(this.getSenders().forEach(b=>{b.track===d&&(a?c=!0:a=b)}),this.getReceivers().forEach(a=>(a.track===d&&(b?c=!0:b=a),a.track===d)),c||a&&b)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():b?b.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return b.apply(this,arguments)}}function u(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let d=b.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(d)&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};let c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(a=>{if(this.getSenders().find(b=>b.track===a))throw new DOMException("Track already exists.","InvalidAccessError")});let b=this.getSenders();c.apply(this,arguments);let d=this.getSenders().filter(a=>-1===b.indexOf(a));this._shimmedLocalStreams[a.id]=[a].concat(d)};let d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};let e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(b=>{let c=this._shimmedLocalStreams[b].indexOf(a);-1!==c&&this._shimmedLocalStreams[b].splice(c,1),1===this._shimmedLocalStreams[b].length&&delete this._shimmedLocalStreams[b]}),e.apply(this,arguments)}}function v(a,b){if(!a.RTCPeerConnection)return;if(a.RTCPeerConnection.prototype.addTrack&&b.version>=65)return u(a);let c=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){let a=c.apply(this);return this._reverseStreams=this._reverseStreams||{},a.map(a=>this._reverseStreams[a.id])};let d=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},b.getTracks().forEach(a=>{if(this.getSenders().find(b=>b.track===a))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[b.id]){let c=new a.MediaStream(b.getTracks());this._streams[b.id]=c,this._reverseStreams[c.id]=b,b=c}d.apply(this,[b])};let e=a.RTCPeerConnection.prototype.removeStream;function f(a,b){let c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(b=>{let d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(RegExp(e.id,"g"),d.id)}),new RTCSessionDescription({type:b.type,sdp:c})}a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.apply(this,[this._streams[a.id]||a]),delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id],delete this._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(a=>a===b))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(a=>a.track===b))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let e=this._streams[c.id];if(e)e.addTrack(b),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let d=new a.MediaStream([b]);this._streams[c.id]=d,this._reverseStreams[d.id]=c,this.addStream(d)}return this.getSenders().find(a=>a.track===b)},["createOffer","createAnswer"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=({[b](){let a=arguments,b=arguments.length&&"function"==typeof arguments[0];return b?c.apply(this,[b=>{let c=f(this,b);a[0].apply(null,[c])},b=>{a[1]&&a[1].apply(null,b)},arguments[2]]):c.apply(this,arguments).then(a=>f(this,a))}})[b]});let g=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var a,b;let c;return arguments.length&&arguments[0].type?(arguments[0]=(a=this,b=arguments[0],c=b.sdp,Object.keys(a._reverseStreams||[]).forEach(b=>{let d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(RegExp(d.id,"g"),e.id)}),new RTCSessionDescription({type:b.type,sdp:c})),g.apply(this,arguments)):g.apply(this,arguments)};let h=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get(){let a=h.get.apply(this);return""===a.type?a:f(this,a)}}),a.RTCPeerConnection.prototype.removeTrack=function(a){let b;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(c=>{this._streams[c].getTracks().find(b=>a.track===b)&&(b=this._streams[c])}),b&&(1===b.getTracks().length?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(a.track),this.dispatchEvent(new Event("negotiationneeded")))}}function w(a,b){!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection),a.RTCPeerConnection&&b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=({[b](){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}})[b]})}function x(a,b){i(a,"negotiationneeded",a=>{let c=a.target;if(!(b.version<72)&&(!c.getConfiguration||"plan-b"!==c.getConfiguration().sdpSemantics)||"stable"===c.signalingState)return a})}a.s(["fixNegotiationNeeded",()=>x,"shimAddTrackRemoveTrack",()=>v,"shimAddTrackRemoveTrackWithNative",()=>u,"shimGetSendersWithDtmf",()=>s,"shimMediaStream",()=>q,"shimOnTrack",()=>r,"shimPeerConnection",()=>w,"shimSenderReceiverGetStats",()=>t],57098),a.i(57098),a.s(["fixNegotiationNeeded",()=>x,"shimAddTrackRemoveTrack",()=>v,"shimAddTrackRemoveTrackWithNative",()=>u,"shimGetSendersWithDtmf",()=>s,"shimGetUserMedia",()=>p,"shimMediaStream",()=>q,"shimOnTrack",()=>r,"shimPeerConnection",()=>w,"shimSenderReceiverGetStats",()=>t],82678);var y,z,A,B,C,D,E,F,G,H,I,J=a.i(82678);function K(a,b){let c=a&&a.navigator,d=a&&a.MediaStreamTrack;if(c.getUserMedia=function(a,b,d){m("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(a).then(b,d)},!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){let a=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},b=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(c){return"object"==typeof c&&"object"==typeof c.audio&&(a((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","mozAutoGainControl"),a(c.audio,"noiseSuppression","mozNoiseSuppression")),b(c)},d&&d.prototype.getSettings){let b=d.prototype.getSettings;d.prototype.getSettings=function(){let c=b.apply(this,arguments);return a(c,"mozAutoGainControl","autoGainControl"),a(c,"mozNoiseSuppression","noiseSuppression"),c}}if(d&&d.prototype.applyConstraints){let b=d.prototype.applyConstraints;d.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"==typeof c&&(a(c=JSON.parse(JSON.stringify(c)),"autoGainControl","mozAutoGainControl"),a(c,"noiseSuppression","mozNoiseSuppression")),b.apply(this,[c])}}}}function L(a,b){a.navigator.mediaDevices&&"getDisplayMedia"in a.navigator.mediaDevices||a.navigator.mediaDevices&&(a.navigator.mediaDevices.getDisplayMedia=function(c){if(!(c&&c.video)){let a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===c.video?c.video={mediaSource:b}:c.video.mediaSource=b,a.navigator.mediaDevices.getUserMedia(c)})}function M(a){"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function N(a,b){if("object"!=typeof a||!(a.RTCPeerConnection||a.mozRTCPeerConnection))return;!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=({[b](){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}})[b]});let c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){let[a,e,f]=arguments;return d.apply(this,[a||null]).then(a=>{if(b.version<53&&!e)try{a.forEach(a=>{a.type=c[a.type]||a.type})}catch(b){if("TypeError"!==b.name)throw b;a.forEach((b,d)=>{a.set(d,Object.assign({},b,{type:c[b.type]||b.type}))})}return a}).then(e,f)}}function O(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)return;let b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a});let c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){let a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function P(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)return;let b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a}),i(a,"track",a=>(a.receiver._pc=a.srcElement,a)),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Q(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){m("removeStream","removeTrack"),this.getSenders().forEach(b=>{b.track&&a.getTracks().includes(b.track)&&this.removeTrack(b)})})}function R(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)}function S(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.addTransceiver;b&&(a.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;void 0===a&&(a=[]);let c=(a=[...a]).length>0;c&&a.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let d=b.apply(this,arguments);if(c){let{sender:b}=d,c=b.getParameters();"encodings"in c&&(1!==c.encodings.length||0!==Object.keys(c.encodings[0]).length)||(c.encodings=a,b.sendEncodings=a,this.setParametersPromises.push(b.setParameters(c).then(()=>{delete b.sendEncodings}).catch(()=>{delete b.sendEncodings})))}return d})}function T(a){if(!("object"==typeof a&&a.RTCRtpSender))return;let b=a.RTCRtpSender.prototype.getParameters;b&&(a.RTCRtpSender.prototype.getParameters=function(){let a=b.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function U(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function V(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.createAnswer;a.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}a.s(["shimAddTransceiver",()=>S,"shimCreateAnswer",()=>V,"shimCreateOffer",()=>U,"shimGetParameters",()=>T,"shimOnTrack",()=>M,"shimPeerConnection",()=>N,"shimRTCDataChannel",()=>R,"shimReceiverGetStats",()=>P,"shimRemoveStream",()=>Q,"shimSenderGetStats",()=>O],96510),a.i(96510),a.s(["shimAddTransceiver",()=>S,"shimCreateAnswer",()=>V,"shimCreateOffer",()=>U,"shimGetDisplayMedia",()=>L,"shimGetParameters",()=>T,"shimGetUserMedia",()=>K,"shimOnTrack",()=>M,"shimPeerConnection",()=>N,"shimRTCDataChannel",()=>R,"shimReceiverGetStats",()=>P,"shimRemoveStream",()=>Q,"shimSenderGetStats",()=>O],56620);var W=a.i(56620);function X(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in a.RTCPeerConnection.prototype)){let b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(c=>b.call(this,c,a)),a.getVideoTracks().forEach(c=>b.call(this,c,a))},a.RTCPeerConnection.prototype.addTrack=function(a,...c){return c&&c.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),b.apply(this,arguments)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);let b=this._localStreams.indexOf(a);if(-1===b)return;this._localStreams.splice(b,1);let c=a.getTracks();this.getSenders().forEach(a=>{c.includes(a.track)&&this.removeTrack(a)})})}}function Y(a){if("object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);let b=new Event("addstream");b.stream=a,this.dispatchEvent(b)})})}});let b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){let a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(b=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(b)>=0)return;a._remoteStreams.push(b);let c=new Event("addstream");c.stream=b,a.dispatchEvent(c)})}),b.apply(a,arguments)}}}function Z(a){if("object"!=typeof a||!a.RTCPeerConnection)return;let b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){let d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){let c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};let h=function(a,b,c){let d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,b.setRemoteDescription=h=function(a,b,c){let d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=function(a,b,c){let d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d}}function $(a){let b=a&&a.navigator;if(b.mediaDevices&&b.mediaDevices.getUserMedia){let a=b.mediaDevices,c=a.getUserMedia.bind(a);b.mediaDevices.getUserMedia=a=>c(_(a))}!b.getUserMedia&&b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=(function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}).bind(b))}function _(a){return a&&void 0!==a.video?Object.assign({},a,{video:function a(b){return n(b)?Object.keys(b).reduce(function(c,d){let e=n(b[d]),f=e?a(b[d]):b[d],g=e&&!Object.keys(f).length;return void 0===f||g?c:Object.assign(c,{[d]:f})},{}):b}(a.video)}):a}function aa(a){if(!a.RTCPeerConnection)return;let b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){let b=[];for(let c=0;c<a.iceServers.length;c++){let d=a.iceServers[c];void 0===d.urls&&d.url?(m("RTCIceServer.url","RTCIceServer.urls"),(d=JSON.parse(JSON.stringify(d))).urls=d.url,delete d.url,b.push(d)):b.push(a.iceServers[c])}a.iceServers=b}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in b&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:()=>b.generateCertificate})}function ab(a){"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ac(a){let b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){void 0!==a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);let b=this.getTransceivers().find(a=>"audio"===a.receiver.track.kind);!1===a.offerToReceiveAudio&&b?"sendrecv"===b.direction?b.setDirection?b.setDirection("sendonly"):b.direction="sendonly":"recvonly"===b.direction&&(b.setDirection?b.setDirection("inactive"):b.direction="inactive"):!0!==a.offerToReceiveAudio||b||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);let c=this.getTransceivers().find(a=>"video"===a.receiver.track.kind);!1===a.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveVideo||c||this.addTransceiver("video",{direction:"recvonly"})}return b.apply(this,arguments)}}function ad(a){"object"!=typeof a||a.AudioContext||(a.AudioContext=a.webkitAudioContext)}a.s(["shimAudioContext",()=>ad,"shimCallbacksAPI",()=>Z,"shimConstraints",()=>_,"shimCreateOfferLegacy",()=>ac,"shimGetUserMedia",()=>$,"shimLocalStreamsAPI",()=>X,"shimRTCIceServerUrls",()=>aa,"shimRemoteStreamsAPI",()=>Y,"shimTrackEventTransceiver",()=>ab],80905);var ae=a.i(80905),af=a.i(48752);function ag(a){if(!a.RTCIceCandidate||a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)return;let b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if("object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&((a=JSON.parse(JSON.stringify(a))).candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){let c=new b(a),d=af.default.parseCandidate(a.candidate);for(let a in d)a in c||Object.defineProperty(c,a,{value:d[a]});return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,i(a,"icecandidate",b=>(b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b))}function ah(a){!a.RTCIceCandidate||a.RTCIceCandidate&&"relayProtocol"in a.RTCIceCandidate.prototype||i(a,"icecandidate",a=>{if(a.candidate){let b=af.default.parseCandidate(a.candidate.candidate);"relay"===b.type&&(a.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[b.priority>>24])}return a})}function ai(a,b){if(!a.RTCPeerConnection)return;"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let c=function(a){if(!a||!a.sdp)return!1;let b=af.default.splitSections(a.sdp);return b.shift(),b.some(a=>{let b=af.default.parseMLine(a);return b&&"application"===b.kind&&-1!==b.protocol.indexOf("SCTP")})},d=function(a){let b=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===b||b.length<2)return -1;let c=parseInt(b[1],10);return c!=c?-1:c},e=function(a){let c=65536;return"firefox"===b.browser&&(c=b.version<57?-1===a?16384:0x7ffffff5:b.version<60?57===b.version?65535:65536:0x7ffffff5),c},f=function(a,c){let d=65536;"firefox"===b.browser&&57===b.version&&(d=65535);let e=af.default.matchPrefix(a.sdp,"a=max-message-size:");return e.length>0?d=parseInt(e[0].substring(19),10):"firefox"===b.browser&&-1!==c&&(d=0x7ffffff5),d},g=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===b.browser&&b.version>=76){let{sdpSemantics:a}=this.getConfiguration();"plan-b"===a&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(c(arguments[0])){let a,b=d(arguments[0]),c=e(b),g=f(arguments[0],b);a=0===c&&0===g?1/0:0===c||0===g?Math.max(c,g):Math.min(c,g);let h={};Object.defineProperty(h,"maxMessageSize",{get:()=>a}),this._sctp=h}return g.apply(this,arguments)}}function aj(a){if(!(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype))return;function b(a,b){let c=a.send;a.send=function(){let d=arguments[0],e=d.length||d.size||d.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}let c=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){let a=c.apply(this,arguments);return b(a,this),a},i(a,"datachannel",a=>(b(a.channel,a.target),a))}function ak(a){if(!a.RTCPeerConnection||"connectionState"in a.RTCPeerConnection.prototype)return;let b=a.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(b,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(a=>{let c=b[a];b[a]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{let b=a.target;if(b._lastConnectionState!==b.connectionState){b._lastConnectionState=b.connectionState;let c=new Event("connectionstatechange",a);b.dispatchEvent(c)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function al(a,b){if(!a.RTCPeerConnection||"chrome"===b.browser&&b.version>=71||"safari"===b.browser&&b._safariVersion>=13.1)return;let c=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(b){if(b&&b.sdp&&-1!==b.sdp.indexOf("\na=extmap-allow-mixed")){let c=b.sdp.split("\n").filter(a=>"a=extmap-allow-mixed"!==a.trim()).join("\n");a.RTCSessionDescription&&b instanceof a.RTCSessionDescription?arguments[0]=new a.RTCSessionDescription({type:b.type,sdp:c}):b.sdp=c}return c.apply(this,arguments)}}function am(a,b){if(!(a.RTCPeerConnection&&a.RTCPeerConnection.prototype))return;let c=a.RTCPeerConnection.prototype.addIceCandidate;c&&0!==c.length&&(a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===b.browser&&b.version<78||"firefox"===b.browser&&b.version<68||"safari"===b.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function an(a,b){if(!(a.RTCPeerConnection&&a.RTCPeerConnection.prototype))return;let c=a.RTCPeerConnection.prototype.setLocalDescription;c&&0!==c.length&&(a.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return c.apply(this,arguments);if(!(a={type:a.type,sdp:a.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?c.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(a=>c.apply(this,[a]))})}a.s(["removeExtmapAllowMixed",()=>al,"shimAddIceCandidateNullOrEmpty",()=>am,"shimConnectionState",()=>ak,"shimMaxMessageSize",()=>ai,"shimParameterlessSetLocalDescription",()=>an,"shimRTCIceCandidate",()=>ag,"shimRTCIceCandidateRelayProtocol",()=>ah,"shimSendThrowTypeError",()=>aj],96235);var ao=a.i(96235);let ap=function({window:a}={},b={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let c=function(a){let b={browser:null,version:null};if(void 0===a||!a.navigator||!a.navigator.userAgent)return b.browser="Not a browser.",b;let{navigator:c}=a;if(c.userAgentData&&c.userAgentData.brands){let a=c.userAgentData.brands.find(a=>"Chromium"===a.brand);if(a)return{browser:"chrome",version:parseInt(a.version,10)}}return c.mozGetUserMedia?(b.browser="firefox",b.version=parseInt(h(c.userAgent,/Firefox\/(\d+)\./,1))):c.webkitGetUserMedia||!1===a.isSecureContext&&a.webkitRTCPeerConnection?(b.browser="chrome",b.version=parseInt(h(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2))):a.RTCPeerConnection&&c.userAgent.match(/AppleWebKit\/(\d+)\./)?(b.browser="safari",b.version=parseInt(h(c.userAgent,/AppleWebKit\/(\d+)\./,1)),b.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype,b._safariVersion=h(c.userAgent,/Version\/(\d+(\.?\d+))/,1)):b.browser="Not a supported browser.",b}(a),d={browserDetails:c,commonShim:ao,extractVersion:h,disableLog:j,disableWarnings:k,sdp:af};switch(c.browser){case"chrome":if(!J||!J.shimPeerConnection||!b.shimChrome){l("Chrome shim is not included in this adapter release.");break}if(null===c.version){l("Chrome shim can not determine version, not shimming.");break}l("adapter.js shimming chrome."),d.browserShim=J,am(a,c),an(a,c),J.shimGetUserMedia(a,c),J.shimMediaStream(a,c),J.shimPeerConnection(a,c),J.shimOnTrack(a,c),J.shimAddTrackRemoveTrack(a,c),J.shimGetSendersWithDtmf(a,c),J.shimSenderReceiverGetStats(a,c),J.fixNegotiationNeeded(a,c),ag(a,c),ah(a,c),ak(a,c),ai(a,c),aj(a,c),al(a,c);break;case"firefox":if(!W||!W.shimPeerConnection||!b.shimFirefox){l("Firefox shim is not included in this adapter release.");break}l("adapter.js shimming firefox."),d.browserShim=W,am(a,c),an(a,c),W.shimGetUserMedia(a,c),W.shimPeerConnection(a,c),W.shimOnTrack(a,c),W.shimRemoveStream(a,c),W.shimSenderGetStats(a,c),W.shimReceiverGetStats(a,c),W.shimRTCDataChannel(a,c),W.shimAddTransceiver(a,c),W.shimGetParameters(a,c),W.shimCreateOffer(a,c),W.shimCreateAnswer(a,c),ag(a,c),ak(a,c),ai(a,c),aj(a,c);break;case"safari":if(!ae||!b.shimSafari){l("Safari shim is not included in this adapter release.");break}l("adapter.js shimming safari."),d.browserShim=ae,am(a,c),an(a,c),ae.shimRTCIceServerUrls(a,c),ae.shimCreateOfferLegacy(a,c),ae.shimCallbacksAPI(a,c),ae.shimLocalStreamsAPI(a,c),ae.shimRemoteStreamsAPI(a,c),ae.shimTrackEventTransceiver(a,c),ae.shimGetUserMedia(a,c),ae.shimAudioContext(a,c),ag(a,c),ah(a,c),ai(a,c),aj(a,c),al(a,c);break;default:l("Unsupported browser!")}return d}({window:void 0});function aq(a,b,c){var d=Math.floor(c/0x100000000);a.setUint32(b,d),a.setUint32(b+4,c)}function ar(a,b){return 0x100000000*a.getInt32(b)+a.getUint32(b+4)}var as=("u"<typeof process||(null==(G=null==process?void 0:process.env)?void 0:G.TEXT_ENCODING)!=="never")&&"u">typeof TextEncoder&&"u">typeof TextDecoder;function at(a){for(var b=a.length,c=0,d=0;d<b;){var e=a.charCodeAt(d++);if((0xffffff80&e)==0){c++;continue}if((0xfffff800&e)==0)c+=2;else{if(e>=55296&&e<=56319&&d<b){var f=a.charCodeAt(d);(64512&f)==56320&&(++d,e=((1023&e)<<10)+(1023&f)+65536)}(0xffff0000&e)==0?c+=3:c+=4}}return c}var au=as?new TextEncoder:void 0,av=as?200*("u">typeof process&&(null==(H=null==process?void 0:process.env)?void 0:H.TEXT_ENCODING)!=="force"):0xffffffff,aw=(null==au?void 0:au.encodeInto)?function(a,b,c){au.encodeInto(a,b.subarray(c))}:function(a,b,c){b.set(au.encode(a),c)};function ax(a,b,c){for(var d=b,e=d+c,f=[],g="";d<e;){var h=a[d++];if((128&h)==0)f.push(h);else if((224&h)==192){var i=63&a[d++];f.push((31&h)<<6|i)}else if((240&h)==224){var i=63&a[d++],j=63&a[d++];f.push((31&h)<<12|i<<6|j)}else if((248&h)==240){var i=63&a[d++],j=63&a[d++],k=(7&h)<<18|i<<12|j<<6|63&a[d++];k>65535&&(k-=65536,f.push(k>>>10&1023|55296),k=56320|1023&k),f.push(k)}else f.push(h);f.length>=4096&&(g+=String.fromCharCode.apply(String,f),f.length=0)}return f.length>0&&(g+=String.fromCharCode.apply(String,f)),g}var ay=as?new TextDecoder:null,az=as?200*("u">typeof process&&(null==(I=null==process?void 0:process.env)?void 0:I.TEXT_DECODER)!=="force"):0xffffffff,aA=function(a,b){this.type=a,this.data=b},aB=(y=function(a,b){return(y=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}y(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),aC=function(a){function b(c){var d=a.call(this,c)||this;return Object.setPrototypeOf(d,Object.create(b.prototype)),Object.defineProperty(d,"name",{configurable:!0,enumerable:!1,value:b.name}),d}return aB(b,a),b}(Error),aD={type:-1,encode:function(a){var b,c,d,e;return a instanceof Date?function(a){var b=a.sec,c=a.nsec;if(b>=0&&c>=0&&b<=0x3ffffffff)if(0===c&&b<=0xffffffff){var d=new Uint8Array(4),e=new DataView(d.buffer);return e.setUint32(0,b),d}else{var f=b/0x100000000,d=new Uint8Array(8),e=new DataView(d.buffer);return e.setUint32(0,c<<2|3&f),e.setUint32(4,0|b),d}var d=new Uint8Array(12),e=new DataView(d.buffer);return e.setUint32(0,c),aq(e,4,b),d}((c=Math.floor((b=a.getTime())/1e3),e=Math.floor((d=(b-1e3*c)*1e6)/1e9),{sec:c+e,nsec:d-1e9*e})):null},decode:function(a){var b=function(a){var b=new DataView(a.buffer,a.byteOffset,a.byteLength);switch(a.byteLength){case 4:var c=b.getUint32(0),d=0;return{sec:c,nsec:0};case 8:var e=b.getUint32(0),c=(3&e)*0x100000000+b.getUint32(4),d=e>>>2;return{sec:c,nsec:d};case 12:var c=ar(b,4),d=b.getUint32(0);return{sec:c,nsec:d};default:throw new aC("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(a.length))}}(a);return new Date(1e3*b.sec+b.nsec/1e6)}},aE=function(){function a(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(aD)}return a.prototype.register=function(a){var b=a.type,c=a.encode,d=a.decode;if(b>=0)this.encoders[b]=c,this.decoders[b]=d;else{var e=1+b;this.builtInEncoders[e]=c,this.builtInDecoders[e]=d}},a.prototype.tryToEncode=function(a,b){for(var c=0;c<this.builtInEncoders.length;c++){var d=this.builtInEncoders[c];if(null!=d){var e=d(a,b);if(null!=e){var f=-1-c;return new aA(f,e)}}}for(var c=0;c<this.encoders.length;c++){var d=this.encoders[c];if(null!=d){var e=d(a,b);if(null!=e){var f=c;return new aA(f,e)}}}return a instanceof aA?a:null},a.prototype.decode=function(a,b,c){var d=b<0?this.builtInDecoders[-1-b]:this.decoders[b];return d?d(a,b,c):new aA(b,a)},a.defaultCodec=new a,a}();function aF(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer?new Uint8Array(a):Uint8Array.from(a)}var aG=function(){function a(a,b,c,d,e,f,g,h){void 0===a&&(a=aE.defaultCodec),void 0===b&&(b=void 0),void 0===c&&(c=100),void 0===d&&(d=2048),void 0===e&&(e=!1),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=!1),this.extensionCodec=a,this.context=b,this.maxDepth=c,this.initialBufferSize=d,this.sortKeys=e,this.forceFloat32=f,this.ignoreUndefined=g,this.forceIntegerToFloat=h,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return a.prototype.reinitializeState=function(){this.pos=0},a.prototype.encodeSharedRef=function(a){return this.reinitializeState(),this.doEncode(a,1),this.bytes.subarray(0,this.pos)},a.prototype.encode=function(a){return this.reinitializeState(),this.doEncode(a,1),this.bytes.slice(0,this.pos)},a.prototype.doEncode=function(a,b){if(b>this.maxDepth)throw Error("Too deep objects in depth ".concat(b));null==a?this.encodeNil():"boolean"==typeof a?this.encodeBoolean(a):"number"==typeof a?this.encodeNumber(a):"string"==typeof a?this.encodeString(a):this.encodeObject(a,b)},a.prototype.ensureBufferSizeToWrite=function(a){var b=this.pos+a;this.view.byteLength<b&&this.resizeBuffer(2*b)},a.prototype.resizeBuffer=function(a){var b=new ArrayBuffer(a),c=new Uint8Array(b),d=new DataView(b);c.set(this.bytes),this.view=d,this.bytes=c},a.prototype.encodeNil=function(){this.writeU8(192)},a.prototype.encodeBoolean=function(a){!1===a?this.writeU8(194):this.writeU8(195)},a.prototype.encodeNumber=function(a){Number.isSafeInteger(a)&&!this.forceIntegerToFloat?a>=0?a<128?this.writeU8(a):a<256?(this.writeU8(204),this.writeU8(a)):a<65536?(this.writeU8(205),this.writeU16(a)):a<0x100000000?(this.writeU8(206),this.writeU32(a)):(this.writeU8(207),this.writeU64(a)):a>=-32?this.writeU8(224|a+32):a>=-128?(this.writeU8(208),this.writeI8(a)):a>=-32768?(this.writeU8(209),this.writeI16(a)):a>=-0x80000000?(this.writeU8(210),this.writeI32(a)):(this.writeU8(211),this.writeI64(a)):this.forceFloat32?(this.writeU8(202),this.writeF32(a)):(this.writeU8(203),this.writeF64(a))},a.prototype.writeStringHeader=function(a){if(a<32)this.writeU8(160+a);else if(a<256)this.writeU8(217),this.writeU8(a);else if(a<65536)this.writeU8(218),this.writeU16(a);else if(a<0x100000000)this.writeU8(219),this.writeU32(a);else throw Error("Too long string: ".concat(a," bytes in UTF-8"))},a.prototype.encodeString=function(a){if(a.length>av){var b=at(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),aw(a,this.bytes,this.pos),this.pos+=b}else{var b=at(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),function(a,b,c){for(var d=a.length,e=c,f=0;f<d;){var g=a.charCodeAt(f++);if((0xffffff80&g)==0){b[e++]=g;continue}if((0xfffff800&g)==0)b[e++]=g>>6&31|192;else{if(g>=55296&&g<=56319&&f<d){var h=a.charCodeAt(f);(64512&h)==56320&&(++f,g=((1023&g)<<10)+(1023&h)+65536)}(0xffff0000&g)==0?b[e++]=g>>12&15|224:(b[e++]=g>>18&7|240,b[e++]=g>>12&63|128),b[e++]=g>>6&63|128}b[e++]=63&g|128}}(a,this.bytes,this.pos),this.pos+=b}},a.prototype.encodeObject=function(a,b){var c=this.extensionCodec.tryToEncode(a,this.context);if(null!=c)this.encodeExtension(c);else if(Array.isArray(a))this.encodeArray(a,b);else if(ArrayBuffer.isView(a))this.encodeBinary(a);else if("object"==typeof a)this.encodeMap(a,b);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(a)))},a.prototype.encodeBinary=function(a){var b=a.byteLength;if(b<256)this.writeU8(196),this.writeU8(b);else if(b<65536)this.writeU8(197),this.writeU16(b);else if(b<0x100000000)this.writeU8(198),this.writeU32(b);else throw Error("Too large binary: ".concat(b));var c=aF(a);this.writeU8a(c)},a.prototype.encodeArray=function(a,b){var c=a.length;if(c<16)this.writeU8(144+c);else if(c<65536)this.writeU8(220),this.writeU16(c);else if(c<0x100000000)this.writeU8(221),this.writeU32(c);else throw Error("Too large array: ".concat(c));for(var d=0;d<a.length;d++){var e=a[d];this.doEncode(e,b+1)}},a.prototype.countWithoutUndefined=function(a,b){for(var c=0,d=0;d<b.length;d++)void 0!==a[b[d]]&&c++;return c},a.prototype.encodeMap=function(a,b){var c=Object.keys(a);this.sortKeys&&c.sort();var d=this.ignoreUndefined?this.countWithoutUndefined(a,c):c.length;if(d<16)this.writeU8(128+d);else if(d<65536)this.writeU8(222),this.writeU16(d);else if(d<0x100000000)this.writeU8(223),this.writeU32(d);else throw Error("Too large map object: ".concat(d));for(var e=0;e<c.length;e++){var f=c[e],g=a[f];this.ignoreUndefined&&void 0===g||(this.encodeString(f),this.doEncode(g,b+1))}},a.prototype.encodeExtension=function(a){var b=a.data.length;if(1===b)this.writeU8(212);else if(2===b)this.writeU8(213);else if(4===b)this.writeU8(214);else if(8===b)this.writeU8(215);else if(16===b)this.writeU8(216);else if(b<256)this.writeU8(199),this.writeU8(b);else if(b<65536)this.writeU8(200),this.writeU16(b);else if(b<0x100000000)this.writeU8(201),this.writeU32(b);else throw Error("Too large extension object: ".concat(b));this.writeI8(a.type),this.writeU8a(a.data)},a.prototype.writeU8=function(a){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,a),this.pos++},a.prototype.writeU8a=function(a){var b=a.length;this.ensureBufferSizeToWrite(b),this.bytes.set(a,this.pos),this.pos+=b},a.prototype.writeI8=function(a){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,a),this.pos++},a.prototype.writeU16=function(a){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,a),this.pos+=2},a.prototype.writeI16=function(a){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,a),this.pos+=2},a.prototype.writeU32=function(a){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,a),this.pos+=4},a.prototype.writeI32=function(a){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,a),this.pos+=4},a.prototype.writeF32=function(a){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,a),this.pos+=4},a.prototype.writeF64=function(a){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,a),this.pos+=8},a.prototype.writeU64=function(a){var b,c;this.ensureBufferSizeToWrite(8),b=this.view,c=this.pos,b.setUint32(c,a/0x100000000),b.setUint32(c+4,a),this.pos+=8},a.prototype.writeI64=function(a){this.ensureBufferSizeToWrite(8),aq(this.view,this.pos,a),this.pos+=8},a}();function aH(a){return"".concat(a<0?"-":"","0x").concat(Math.abs(a).toString(16).padStart(2,"0"))}var aI=function(){function a(a,b){void 0===a&&(a=16),void 0===b&&(b=16),this.maxKeyLength=a,this.maxLengthPerKey=b,this.hit=0,this.miss=0,this.caches=[];for(var c=0;c<this.maxKeyLength;c++)this.caches.push([])}return a.prototype.canBeCached=function(a){return a>0&&a<=this.maxKeyLength},a.prototype.find=function(a,b,c){var d=this.caches[c-1];a:for(var e=0;e<d.length;e++){for(var f=d[e],g=f.bytes,h=0;h<c;h++)if(g[h]!==a[b+h])continue a;return f.str}return null},a.prototype.store=function(a,b){var c=this.caches[a.length-1],d={bytes:a,str:b};c.length>=this.maxLengthPerKey?c[Math.random()*c.length|0]=d:c.push(d)},a.prototype.decode=function(a,b,c){var d=this.find(a,b,c);if(null!=d)return this.hit++,d;this.miss++;var e=ax(a,b,c),f=Uint8Array.prototype.slice.call(a,b,b+c);return this.store(f,e),e},a}(),aJ=function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}},aK=function(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a="function"==typeof __values?__values(a):a[Symbol.iterator](),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}},aL=function(a){return this instanceof aL?(this.v=a,this):new aL(a)},aM=function(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof aL?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}},aN=function(a){var b=typeof a;return"string"===b||"number"===b},aO=new DataView(new ArrayBuffer(0)),aP=new Uint8Array(aO.buffer),aQ=function(){try{aO.getInt8(0)}catch(a){return a.constructor}throw Error("never reached")}(),aR=new aQ("Insufficient data"),aS=new aI,aT=function(){function a(a,b,c,d,e,f,g,h){void 0===a&&(a=aE.defaultCodec),void 0===b&&(b=void 0),void 0===c&&(c=0xffffffff),void 0===d&&(d=0xffffffff),void 0===e&&(e=0xffffffff),void 0===f&&(f=0xffffffff),void 0===g&&(g=0xffffffff),void 0===h&&(h=aS),this.extensionCodec=a,this.context=b,this.maxStrLength=c,this.maxBinLength=d,this.maxArrayLength=e,this.maxMapLength=f,this.maxExtLength=g,this.keyDecoder=h,this.totalPos=0,this.pos=0,this.view=aO,this.bytes=aP,this.headByte=-1,this.stack=[]}return a.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},a.prototype.setBuffer=function(a){this.bytes=aF(a),this.view=function(a){if(a instanceof ArrayBuffer)return new DataView(a);var b=aF(a);return new DataView(b.buffer,b.byteOffset,b.byteLength)}(this.bytes),this.pos=0},a.prototype.appendBuffer=function(a){if(-1!==this.headByte||this.hasRemaining(1)){var b=this.bytes.subarray(this.pos),c=aF(a),d=new Uint8Array(b.length+c.length);d.set(b),d.set(c,b.length),this.setBuffer(d)}else this.setBuffer(a)},a.prototype.hasRemaining=function(a){return this.view.byteLength-this.pos>=a},a.prototype.createExtraByteError=function(a){var b=this.view,c=this.pos;return RangeError("Extra ".concat(b.byteLength-c," of ").concat(b.byteLength," byte(s) found at buffer[").concat(a,"]"))},a.prototype.decode=function(a){this.reinitializeState(),this.setBuffer(a);var b=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return b},a.prototype.decodeMulti=function(a){return aJ(this,function(b){switch(b.label){case 0:this.reinitializeState(),this.setBuffer(a),b.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return b.sent(),[3,1];case 3:return[2]}})},a.prototype.decodeAsync=function(a){var b,c,d,e,f,g,h,i;return f=this,g=void 0,h=void 0,i=function(){var f,g,h,i,j,k,l;return aJ(this,function(m){switch(m.label){case 0:f=!1,m.label=1;case 1:m.trys.push([1,6,7,12]),b=aK(a),m.label=2;case 2:return[4,b.next()];case 3:if((c=m.sent()).done)return[3,5];if(h=c.value,f)throw this.createExtraByteError(this.totalPos);this.appendBuffer(h);try{g=this.doDecodeSync(),f=!0}catch(a){if(!(a instanceof aQ))throw a}this.totalPos+=this.pos,m.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return d={error:m.sent()},[3,12];case 7:if(m.trys.push([7,,10,11]),!(c&&!c.done&&(e=b.return)))return[3,9];return[4,e.call(b)];case 8:m.sent(),m.label=9;case 9:return[3,11];case 10:if(d)throw d.error;return[7];case 11:return[7];case 12:if(f){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,g]}throw i=this,j=i.headByte,k=i.pos,l=i.totalPos,RangeError("Insufficient data in parsing ".concat(aH(j)," at ").concat(l," (").concat(k," in the current buffer)"))}})},new(h||(h=Promise))(function(a,b){function c(a){try{e(i.next(a))}catch(a){b(a)}}function d(a){try{e(i.throw(a))}catch(a){b(a)}}function e(b){var e;b.done?a(b.value):((e=b.value)instanceof h?e:new h(function(a){a(e)})).then(c,d)}e((i=i.apply(f,g||[])).next())})},a.prototype.decodeArrayStream=function(a){return this.decodeMultiAsync(a,!0)},a.prototype.decodeStream=function(a){return this.decodeMultiAsync(a,!1)},a.prototype.decodeMultiAsync=function(a,b){return aM(this,arguments,function(){var c,d,e,f,g,h,i,j;return aJ(this,function(k){switch(k.label){case 0:c=b,d=-1,k.label=1;case 1:k.trys.push([1,13,14,19]),e=aK(a),k.label=2;case 2:return[4,aL(e.next())];case 3:if((f=k.sent()).done)return[3,12];if(g=f.value,b&&0===d)throw this.createExtraByteError(this.totalPos);this.appendBuffer(g),c&&(d=this.readArraySize(),c=!1,this.complete()),k.label=4;case 4:k.trys.push([4,9,,10]),k.label=5;case 5:return[4,aL(this.doDecodeSync())];case 6:return[4,k.sent()];case 7:if(k.sent(),0==--d)return[3,8];return[3,5];case 8:return[3,10];case 9:if(!((h=k.sent())instanceof aQ))throw h;return[3,10];case 10:this.totalPos+=this.pos,k.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return i={error:k.sent()},[3,19];case 14:if(k.trys.push([14,,17,18]),!(f&&!f.done&&(j=e.return)))return[3,16];return[4,aL(j.call(e))];case 15:k.sent(),k.label=16;case 16:return[3,18];case 17:if(i)throw i.error;return[7];case 18:return[7];case 19:return[2]}})})},a.prototype.doDecodeSync=function(){b:for(;;){var a=this.readHeadByte(),b=void 0;if(a>=224)b=a-256;else if(a<192)if(a<128)b=a;else if(a<144){var c=a-128;if(0!==c){this.pushMapState(c),this.complete();continue}b={}}else if(a<160){var c=a-144;if(0!==c){this.pushArrayState(c),this.complete();continue}b=[]}else{var d=a-160;b=this.decodeUtf8String(d,0)}else if(192===a)b=null;else if(194===a)b=!1;else if(195===a)b=!0;else if(202===a)b=this.readF32();else if(203===a)b=this.readF64();else if(204===a)b=this.readU8();else if(205===a)b=this.readU16();else if(206===a)b=this.readU32();else if(207===a)b=this.readU64();else if(208===a)b=this.readI8();else if(209===a)b=this.readI16();else if(210===a)b=this.readI32();else if(211===a)b=this.readI64();else if(217===a){var d=this.lookU8();b=this.decodeUtf8String(d,1)}else if(218===a){var d=this.lookU16();b=this.decodeUtf8String(d,2)}else if(219===a){var d=this.lookU32();b=this.decodeUtf8String(d,4)}else if(220===a){var c=this.readU16();if(0!==c){this.pushArrayState(c),this.complete();continue}b=[]}else if(221===a){var c=this.readU32();if(0!==c){this.pushArrayState(c),this.complete();continue}b=[]}else if(222===a){var c=this.readU16();if(0!==c){this.pushMapState(c),this.complete();continue}b={}}else if(223===a){var c=this.readU32();if(0!==c){this.pushMapState(c),this.complete();continue}b={}}else if(196===a){var c=this.lookU8();b=this.decodeBinary(c,1)}else if(197===a){var c=this.lookU16();b=this.decodeBinary(c,2)}else if(198===a){var c=this.lookU32();b=this.decodeBinary(c,4)}else if(212===a)b=this.decodeExtension(1,0);else if(213===a)b=this.decodeExtension(2,0);else if(214===a)b=this.decodeExtension(4,0);else if(215===a)b=this.decodeExtension(8,0);else if(216===a)b=this.decodeExtension(16,0);else if(199===a){var c=this.lookU8();b=this.decodeExtension(c,1)}else if(200===a){var c=this.lookU16();b=this.decodeExtension(c,2)}else if(201===a){var c=this.lookU32();b=this.decodeExtension(c,4)}else throw new aC("Unrecognized type byte: ".concat(aH(a)));this.complete();for(var e=this.stack;e.length>0;){var f=e[e.length-1];if(0===f.type)if(f.array[f.position]=b,f.position++,f.position===f.size)e.pop(),b=f.array;else continue b;else if(1===f.type){if(!aN(b))throw new aC("The type of key must be string or number but "+typeof b);if("__proto__"===b)throw new aC("The key __proto__ is not allowed");f.key=b,f.type=2;continue b}else if(f.map[f.key]=b,f.readCount++,f.readCount===f.size)e.pop(),b=f.map;else{f.key=null,f.type=1;continue b}}return b}},a.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},a.prototype.complete=function(){this.headByte=-1},a.prototype.readArraySize=function(){var a=this.readHeadByte();switch(a){case 220:return this.readU16();case 221:return this.readU32();default:if(a<160)return a-144;throw new aC("Unrecognized array type byte: ".concat(aH(a)))}},a.prototype.pushMapState=function(a){if(a>this.maxMapLength)throw new aC("Max length exceeded: map length (".concat(a,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:a,key:null,readCount:0,map:{}})},a.prototype.pushArrayState=function(a){if(a>this.maxArrayLength)throw new aC("Max length exceeded: array length (".concat(a,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:a,array:Array(a),position:0})},a.prototype.decodeUtf8String=function(a,b){if(a>this.maxStrLength)throw new aC("Max length exceeded: UTF-8 byte length (".concat(a,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+b+a)throw aR;var c,d,e,f,g=this.pos+b;return this.stateIsMapKey()&&(null==(e=this.keyDecoder)?void 0:e.canBeCached(a))?f=this.keyDecoder.decode(this.bytes,g,a):a>az?(c=this.bytes,d=c.subarray(g,g+a),f=ay.decode(d)):f=ax(this.bytes,g,a),this.pos+=b+a,f},a.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},a.prototype.decodeBinary=function(a,b){if(a>this.maxBinLength)throw new aC("Max length exceeded: bin length (".concat(a,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(a+b))throw aR;var c=this.pos+b,d=this.bytes.subarray(c,c+a);return this.pos+=b+a,d},a.prototype.decodeExtension=function(a,b){if(a>this.maxExtLength)throw new aC("Max length exceeded: ext length (".concat(a,") > maxExtLength (").concat(this.maxExtLength,")"));var c=this.view.getInt8(this.pos+b),d=this.decodeBinary(a,b+1);return this.extensionCodec.decode(d,c,this.context)},a.prototype.lookU8=function(){return this.view.getUint8(this.pos)},a.prototype.lookU16=function(){return this.view.getUint16(this.pos)},a.prototype.lookU32=function(){return this.view.getUint32(this.pos)},a.prototype.readU8=function(){var a=this.view.getUint8(this.pos);return this.pos++,a},a.prototype.readI8=function(){var a=this.view.getInt8(this.pos);return this.pos++,a},a.prototype.readU16=function(){var a=this.view.getUint16(this.pos);return this.pos+=2,a},a.prototype.readI16=function(){var a=this.view.getInt16(this.pos);return this.pos+=2,a},a.prototype.readU32=function(){var a=this.view.getUint32(this.pos);return this.pos+=4,a},a.prototype.readI32=function(){var a=this.view.getInt32(this.pos);return this.pos+=4,a},a.prototype.readU64=function(){var a,b,c=(a=this.view,b=this.pos,0x100000000*a.getUint32(b)+a.getUint32(b+4));return this.pos+=8,c},a.prototype.readI64=function(){var a=ar(this.view,this.pos);return this.pos+=8,a},a.prototype.readF32=function(){var a=this.view.getFloat32(this.pos);return this.pos+=4,a},a.prototype.readF64=function(){var a=this.view.getFloat64(this.pos);return this.pos+=8,a},a}(),aU=function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}},aV=function(a){return this instanceof aV?(this.v=a,this):new aV(a)},aW=function(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof aV?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}},aX={};function aY(a,b,c,d){Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})}class aZ{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=a=>{let b=[],c=a.byteLength,d=Math.ceil(c/this.chunkedMTU),e=0,f=0;for(;f<c;){let g=Math.min(c,f+this.chunkedMTU),h=a.slice(f,g),i={__peerData:this._dataCount,n:e,data:h,total:d};b.push(i),f=g,e++}return this._dataCount++,b}}}let a$=ap.default||ap,a_=new class{isWebRTCSupported(){return"u">typeof RTCPeerConnection}isBrowserSupported(){let a=this.getBrowser(),b=this.getVersion();return!!this.supportedBrowsers.includes(a)&&("chrome"===a?b>=this.minChromeVersion:"firefox"===a?b>=this.minFirefoxVersion:"safari"===a&&!this.isIOS&&b>=this.minSafariVersion)}getBrowser(){return a$.browserDetails.browser}getVersion(){return a$.browserDetails.version||0}isUnifiedPlanSupported(){let a,b=this.getBrowser(),c=a$.browserDetails.version||0;if("chrome"===b&&c<this.minChromeVersion)return!1;if("firefox"===b&&c>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let d=!1;try{(a=new RTCPeerConnection).addTransceiver("audio"),d=!0}catch(a){}finally{a&&a.close()}return d}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS="u">typeof navigator&&["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},a0=a=>!a||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(a),a1=()=>Math.random().toString(36).slice(2),a2={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},a3=new class extends aZ{noop(){}blobToArrayBuffer(a,b){let c=new FileReader;return c.onload=function(a){a.target&&b(a.target.result)},c.readAsArrayBuffer(a),c}binaryStringToArrayBuffer(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=255&a.charCodeAt(c);return b.buffer}isSecure(){return"https:"===location.protocol}constructor(...a){super(...a),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=a2,this.browser=a_.getBrowser(),this.browserVersion=a_.getVersion(),this.pack=d,this.unpack=c,this.supports=function(){let a,b={browser:a_.isBrowserSupported(),webRTC:a_.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!b.webRTC)return b;try{let c;a=new RTCPeerConnection(a2),b.audioVideo=!0;try{c=a.createDataChannel("_PEERJSTEST",{ordered:!0}),b.data=!0,b.reliable=!!c.ordered;try{c.binaryType="blob",b.binaryBlob=!a_.isIOS}catch(a){}}catch(a){}finally{c&&c.close()}}catch(a){}finally{a&&a.close()}return b}(),this.validateId=a0,this.randomToken=a1}};var a4=new class{get logLevel(){return this._logLevel}set logLevel(a){this._logLevel=a}log(...a){this._logLevel>=3&&this._print(3,...a)}warn(...a){this._logLevel>=2&&this._print(2,...a)}error(...a){this._logLevel>=1&&this._print(1,...a)}setLogFunction(a){this._print=a}_print(a,...b){let c=["PeerJS: ",...b];for(let a in c)c[a]instanceof Error&&(c[a]="("+c[a].name+") "+c[a].message);a>=3?console.log(...c):a>=2?console.warn("WARNING",...c):a>=1&&console.error("ERROR",...c)}constructor(){this._logLevel=0}},a5={},a6=Object.prototype.hasOwnProperty,a7="~";function a8(){}function a9(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function ba(a,b,c,d,e){if("function"!=typeof c)throw TypeError("The listener must be a function");var f=new a9(c,d||a,e),g=a7?a7+b:b;return a._events[g]?a._events[g].fn?a._events[g]=[a._events[g],f]:a._events[g].push(f):(a._events[g]=f,a._eventsCount++),a}function bb(a,b){0==--a._eventsCount?a._events=new a8:delete a._events[b]}function bc(){this._events=new a8,this._eventsCount=0}Object.create&&(a8.prototype=Object.create(null),new a8().__proto__||(a7=!1)),bc.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)a6.call(a,b)&&c.push(a7?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},bc.prototype.listeners=function(a){var b=a7?a7+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=Array(e);d<e;d++)f[d]=c[d].fn;return f},bc.prototype.listenerCount=function(a){var b=a7?a7+a:a,c=this._events[b];return c?c.fn?1:c.length:0},bc.prototype.emit=function(a,b,c,d,e,f){var g=a7?a7+a:a;if(!this._events[g])return!1;var h,i,j=this._events[g],k=arguments.length;if(j.fn){switch(j.once&&this.removeListener(a,j.fn,void 0,!0),k){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,b),!0;case 3:return j.fn.call(j.context,b,c),!0;case 4:return j.fn.call(j.context,b,c,d),!0;case 5:return j.fn.call(j.context,b,c,d,e),!0;case 6:return j.fn.call(j.context,b,c,d,e,f),!0}for(i=1,h=Array(k-1);i<k;i++)h[i-1]=arguments[i];j.fn.apply(j.context,h)}else{var l,m=j.length;for(i=0;i<m;i++)switch(j[i].once&&this.removeListener(a,j[i].fn,void 0,!0),k){case 1:j[i].fn.call(j[i].context);break;case 2:j[i].fn.call(j[i].context,b);break;case 3:j[i].fn.call(j[i].context,b,c);break;case 4:j[i].fn.call(j[i].context,b,c,d);break;default:if(!h)for(l=1,h=Array(k-1);l<k;l++)h[l-1]=arguments[l];j[i].fn.apply(j[i].context,h)}}return!0},bc.prototype.on=function(a,b,c){return ba(this,a,b,c,!1)},bc.prototype.once=function(a,b,c){return ba(this,a,b,c,!0)},bc.prototype.removeListener=function(a,b,c,d){var e=a7?a7+a:a;if(!this._events[e])return this;if(!b)return bb(this,e),this;var f=this._events[e];if(f.fn)f.fn!==b||d&&!f.once||c&&f.context!==c||bb(this,e);else{for(var g=0,h=[],i=f.length;g<i;g++)(f[g].fn!==b||d&&!f[g].once||c&&f[g].context!==c)&&h.push(f[g]);h.length?this._events[e]=1===h.length?h[0]:h:bb(this,e)}return this},bc.prototype.removeAllListeners=function(a){var b;return a?(b=a7?a7+a:a,this._events[b]&&bb(this,b)):(this._events=new a8,this._eventsCount=0),this},bc.prototype.off=bc.prototype.removeListener,bc.prototype.addListener=bc.prototype.on,bc.prefixed=a7,bc.EventEmitter=bc,a5=bc;var bd={};aY(bd,"ConnectionType",()=>be),aY(bd,"PeerErrorType",()=>bf),aY(bd,"BaseConnectionErrorType",()=>bg),aY(bd,"DataConnectionErrorType",()=>bh),aY(bd,"SerializationType",()=>bi),aY(bd,"SocketEventType",()=>bj),aY(bd,"ServerMessageType",()=>bk);var be=((z={}).Data="data",z.Media="media",z),bf=((A={}).BrowserIncompatible="browser-incompatible",A.Disconnected="disconnected",A.InvalidID="invalid-id",A.InvalidKey="invalid-key",A.Network="network",A.PeerUnavailable="peer-unavailable",A.SslUnavailable="ssl-unavailable",A.ServerError="server-error",A.SocketError="socket-error",A.SocketClosed="socket-closed",A.UnavailableID="unavailable-id",A.WebRTC="webrtc",A),bg=((B={}).NegotiationFailed="negotiation-failed",B.ConnectionClosed="connection-closed",B),bh=((C={}).NotOpenYet="not-open-yet",C.MessageToBig="message-too-big",C),bi=((D={}).Binary="binary",D.BinaryUTF8="binary-utf8",D.JSON="json",D.None="raw",D),bj=((E={}).Message="message",E.Disconnected="disconnected",E.Error="error",E.Close="close",E),bk=((F={}).Heartbeat="HEARTBEAT",F.Candidate="CANDIDATE",F.Offer="OFFER",F.Answer="ANSWER",F.Open="OPEN",F.Error="ERROR",F.IdTaken="ID-TAKEN",F.InvalidKey="INVALID-KEY",F.Leave="LEAVE",F.Expire="EXPIRE",F);let bl="1.5.5";class bm extends a5.EventEmitter{constructor(a,b,c,d,e,f=5e3){super(),this.pingInterval=f,this._disconnected=!0,this._messagesQueue=[],this._baseUrl=(a?"wss://":"ws://")+b+":"+c+d+"peerjs?key="+e}start(a,b){this._id=a;let c=`${this._baseUrl}&id=${a}&token=${b}`;!this._socket&&this._disconnected&&(this._socket=new WebSocket(c+"&version="+bl),this._disconnected=!1,this._socket.onmessage=a=>{let b;try{b=JSON.parse(a.data),a4.log("Server message received:",b)}catch(b){a4.log("Invalid server message",a.data);return}this.emit(bj.Message,b)},this._socket.onclose=a=>{this._disconnected||(a4.log("Socket closed.",a),this._cleanup(),this._disconnected=!0,this.emit(bj.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),a4.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen())return void a4.log("Cannot send heartbeat, because socket closed");let a=JSON.stringify({type:bk.Heartbeat});this._socket.send(a),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&1===this._socket.readyState}_sendQueuedMessages(){let a=[...this._messagesQueue];for(let b of(this._messagesQueue=[],a))this.send(b)}send(a){if(this._disconnected)return;if(!this._id)return void this._messagesQueue.push(a);if(!a.type)return void this.emit(bj.Error,"Invalid message");if(!this._wsOpen())return;let b=JSON.stringify(a);this._socket.send(b)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class bn{constructor(a){this.connection=a}startConnection(a){let b=this._startPeerConnection();if(this.connection.peerConnection=b,this.connection.type===be.Media&&a._stream&&this._addTracksToConnection(a._stream,b),a.originator){let c=this.connection,d={ordered:!!a.reliable},e=b.createDataChannel(c.label,d);c._initializeDataChannel(e),this._makeOffer()}else this.handleSDP("OFFER",a.sdp)}_startPeerConnection(){a4.log("Creating RTCPeerConnection.");let a=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(a),a}_setupListeners(a){let b=this.connection.peer,c=this.connection.connectionId,d=this.connection.type,e=this.connection.provider;a4.log("Listening for ICE candidates."),a.onicecandidate=a=>{a.candidate&&a.candidate.candidate&&(a4.log(`Received ICE candidates for ${b}:`,a.candidate),e.socket.send({type:bk.Candidate,payload:{candidate:a.candidate,type:d,connectionId:c},dst:b}))},a.oniceconnectionstatechange=()=>{switch(a.iceConnectionState){case"failed":a4.log("iceConnectionState is failed, closing connections to "+b),this.connection.emitError(bg.NegotiationFailed,"Negotiation of connection to "+b+" failed."),this.connection.close();break;case"closed":a4.log("iceConnectionState is closed, closing connections to "+b),this.connection.emitError(bg.ConnectionClosed,"Connection to "+b+" closed."),this.connection.close();break;case"disconnected":a4.log("iceConnectionState changed to disconnected on the connection with "+b);break;case"completed":a.onicecandidate=()=>{}}this.connection.emit("iceStateChanged",a.iceConnectionState)},a4.log("Listening for data channel"),a.ondatachannel=a=>{a4.log("Received data channel");let d=a.channel;e.getConnection(b,c)._initializeDataChannel(d)},a4.log("Listening for remote stream"),a.ontrack=a=>{a4.log("Received remote stream");let d=a.streams[0],f=e.getConnection(b,c);f.type===be.Media&&this._addStreamToMediaConnection(d,f)}}cleanup(){a4.log("Cleaning up PeerConnection to "+this.connection.peer);let a=this.connection.peerConnection;if(!a)return;this.connection.peerConnection=null,a.onicecandidate=a.oniceconnectionstatechange=a.ondatachannel=a.ontrack=()=>{};let b="closed"!==a.signalingState,c=!1,d=this.connection.dataChannel;d&&(c=!!d.readyState&&"closed"!==d.readyState),(b||c)&&a.close()}async _makeOffer(){let a=this.connection.peerConnection,b=this.connection.provider;try{let c=await a.createOffer(this.connection.options.constraints);a4.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp);try{await a.setLocalDescription(c),a4.log("Set localDescription:",c,`for:${this.connection.peer}`);let d={sdp:c,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===be.Data){let a=this.connection;d={...d,label:a.label,reliable:a.reliable,serialization:a.serialization}}b.socket.send({type:bk.Offer,payload:d,dst:this.connection.peer})}catch(a){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=a&&(b.emitError(bf.WebRTC,a),a4.log("Failed to setLocalDescription, ",a))}}catch(a){b.emitError(bf.WebRTC,a),a4.log("Failed to createOffer, ",a)}}async _makeAnswer(){let a=this.connection.peerConnection,b=this.connection.provider;try{let c=await a.createAnswer();a4.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp);try{await a.setLocalDescription(c),a4.log("Set localDescription:",c,`for:${this.connection.peer}`),b.socket.send({type:bk.Answer,payload:{sdp:c,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(a){b.emitError(bf.WebRTC,a),a4.log("Failed to setLocalDescription, ",a)}}catch(a){b.emitError(bf.WebRTC,a),a4.log("Failed to create answer, ",a)}}async handleSDP(a,b){b=new RTCSessionDescription(b);let c=this.connection.peerConnection,d=this.connection.provider;a4.log("Setting remote description",b);try{await c.setRemoteDescription(b),a4.log(`Set remoteDescription:${a} for:${this.connection.peer}`),"OFFER"===a&&await this._makeAnswer()}catch(a){d.emitError(bf.WebRTC,a),a4.log("Failed to setRemoteDescription, ",a)}}async handleCandidate(a){a4.log("handleCandidate:",a);try{await this.connection.peerConnection.addIceCandidate(a),a4.log(`Added ICE candidate for:${this.connection.peer}`)}catch(a){this.connection.provider.emitError(bf.WebRTC,a),a4.log("Failed to handleCandidate, ",a)}}_addTracksToConnection(a,b){if(a4.log(`add tracks from stream ${a.id} to peer connection`),!b.addTrack)return a4.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");a.getTracks().forEach(c=>{b.addTrack(c,a)})}_addStreamToMediaConnection(a,b){a4.log(`add stream ${a.id} to media connection ${b.connectionId}`),b.addStream(a)}}class bo extends a5.EventEmitter{emitError(a,b){a4.error("Error:",b),this.emit("error",new bp(`${a}`,b))}}class bp extends Error{constructor(a,b){"string"==typeof b?super(b):(super(),Object.assign(this,b)),this.type=a}}class bq extends bo{get open(){return this._open}constructor(a,b,c){super(),this.peer=a,this.provider=b,this.options=c,this._open=!1,this.metadata=c.metadata}}class br extends bq{static #a=this.ID_PREFIX="mc_";get type(){return be.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(a,b,c){super(a,b,c),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||br.ID_PREFIX+a3.randomToken(),this._negotiator=new bn(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(a){this.dataChannel=a,this.dataChannel.onopen=()=>{a4.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{a4.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(a){a4.log("Receiving stream",a),this._remoteStream=a,super.emit("stream",a)}handleMessage(a){let b=a.type,c=a.payload;switch(a.type){case bk.Answer:this._negotiator.handleSDP(b,c.sdp),this._open=!0;break;case bk.Candidate:this._negotiator.handleCandidate(c.candidate);break;default:a4.warn(`Unrecognized message type:${b} from peer:${this.peer}`)}}answer(a,b={}){if(this._localStream)return void a4.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");for(let c of(this._localStream=a,b&&b.sdpTransform&&(this.options.sdpTransform=b.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:a}),this.provider._getMessages(this.connectionId)))this.handleMessage(c);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class bs{constructor(a){this._options=a}_buildRequest(a){let b=this._options.secure?"https":"http",{host:c,port:d,path:e,key:f}=this._options,g=new URL(`${b}://${c}:${d}${e}${f}/${a}`);return g.searchParams.set("ts",`${Date.now()}${Math.random()}`),g.searchParams.set("version",bl),fetch(g.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{let a=await this._buildRequest("id");if(200!==a.status)throw Error(`Error. Status:${a.status}`);return a.text()}catch(b){a4.error("Error retrieving ID",b);let a="";throw"/"===this._options.path&&this._options.host!==a3.CLOUD_HOST&&(a=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),Error("Could not get an ID from the server."+a)}}async listAllPeers(){try{let a=await this._buildRequest("peers");if(200!==a.status){if(401===a.status){let a="";throw a=this._options.host===a3.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",Error("It doesn't look like you have permission to list peers IDs. "+a)}throw Error(`Error. Status:${a.status}`)}return a.json()}catch(a){throw a4.error("Error retrieving list peers",a),Error("Could not get list peers from the server."+a)}}}class bt extends bq{static #a=this.ID_PREFIX="dc_";static #b=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return be.Data}constructor(a,b,c){super(a,b,c),this.connectionId=this.options.connectionId||bt.ID_PREFIX+a1(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new bn(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(a){this.dataChannel=a,this.dataChannel.onopen=()=>{a4.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=a=>{a4.log(`DC#${this.connectionId} dc onmessage:`,a.data)},this.dataChannel.onclose=()=>{a4.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(a){a?.flush?this.send({__peerData:{type:"close"}}):(this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close")))}send(a,b=!1){return this.open?this._send(a,b):void this.emitError(bh.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.")}async handleMessage(a){let b=a.payload;switch(a.type){case bk.Answer:await this._negotiator.handleSDP(a.type,b.sdp);break;case bk.Candidate:await this._negotiator.handleCandidate(b.candidate);break;default:a4.warn("Unrecognized message type:",a.type,"from peer:",this.peer)}}}class bu extends bt{get bufferSize(){return this._bufferSize}_initializeDataChannel(a){super._initializeDataChannel(a),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",a=>this._handleDataMessage(a))}_bufferedSend(a){(this._buffering||!this._trySend(a))&&(this._buffer.push(a),this._bufferSize=this._buffer.length)}_trySend(a){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>bt.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(a)}catch(a){return a4.error(`DC#:${this.connectionId} Error when sending:`,a),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||0===this._buffer.length)return;let a=this._buffer[0];this._trySend(a)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(a){a?.flush?this.send({__peerData:{type:"close"}}):(this._buffer=[],this._bufferSize=0,super.close())}constructor(...a){super(...a),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class bv extends bu{close(a){super.close(a),this._chunkedData={}}constructor(a,b,c){super(a,b,c),this.chunker=new aZ,this.serialization=bi.Binary,this._chunkedData={}}_handleDataMessage({data:a}){let b=c(a),d=b.__peerData;d?"close"===d.type?this.close():this._handleChunk(b):this.emit("data",b)}_handleChunk(a){let b=a.__peerData,c=this._chunkedData[b]||{data:[],count:0,total:a.total};if(c.data[a.n]=new Uint8Array(a.data),c.count++,this._chunkedData[b]=c,c.total===c.count){delete this._chunkedData[b];let a=function(a){let b=0;for(let c of a)b+=c.byteLength;let c=new Uint8Array(b),d=0;for(let b of a)c.set(b,d),d+=b.byteLength;return c}(c.data);this._handleDataMessage({data:a})}}_send(a,b){let c=d(a);return c instanceof Promise?this._send_blob(c):!b&&c.byteLength>this.chunker.chunkedMTU?void this._sendChunks(c):void this._bufferedSend(c)}async _send_blob(a){let b=await a;b.byteLength>this.chunker.chunkedMTU?this._sendChunks(b):this._bufferedSend(b)}_sendChunks(a){let b=this.chunker.chunk(a);for(let a of(a4.log(`DC#${this.connectionId} Try to send ${b.length} chunks...`),b))this.send(a,!0)}}class bw extends bu{_handleDataMessage({data:a}){super.emit("data",a)}_send(a,b){this._bufferedSend(a)}constructor(...a){super(...a),this.serialization=bi.None}}class bx extends bu{_handleDataMessage({data:a}){let b=this.parse(this.decoder.decode(a)),c=b.__peerData;c&&"close"===c.type?this.close():this.emit("data",b)}_send(a,b){let c=this.encoder.encode(this.stringify(a));c.byteLength>=a3.chunkedMTU?this.emitError(bh.MessageToBig,"Message too big for JSON channel"):this._bufferedSend(c)}constructor(...a){super(...a),this.serialization=bi.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class by extends bo{static #a=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){let a=Object.create(null);for(let[b,c]of this._connections)a[b]=c;return a}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(a,b){let c;if(super(),this._serializers={raw:bw,json:bx,binary:bv,"binary-utf8":bv,default:bv},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map,a&&a.constructor==Object?b=a:a&&(c=a.toString()),b={debug:0,host:a3.CLOUD_HOST,port:a3.CLOUD_PORT,path:"/",key:by.DEFAULT_KEY,token:a3.randomToken(),config:a3.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...b},this._options=b,this._serializers={...this._serializers,...this.options.serializers},"/"===this._options.host&&(this._options.host=window.location.hostname),this._options.path&&("/"!==this._options.path[0]&&(this._options.path="/"+this._options.path),"/"!==this._options.path[this._options.path.length-1]&&(this._options.path+="/")),void 0===this._options.secure&&this._options.host!==a3.CLOUD_HOST?this._options.secure=a3.isSecure():this._options.host==a3.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&a4.setLogFunction(this._options.logFunction),a4.logLevel=this._options.debug||0,this._api=new bs(b),this._socket=this._createServerConnection(),!a3.supports.audioVideo&&!a3.supports.data)return void this._delayedAbort(bf.BrowserIncompatible,"The current browser does not support WebRTC");if(c&&!a3.validateId(c))return void this._delayedAbort(bf.InvalidID,`ID "${c}" is invalid`);c?this._initialize(c):this._api.retrieveId().then(a=>this._initialize(a)).catch(a=>this._abort(bf.ServerError,a))}_createServerConnection(){let a=new bm(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return a.on(bj.Message,a=>{this._handleMessage(a)}),a.on(bj.Error,a=>{this._abort(bf.SocketError,a)}),a.on(bj.Disconnected,()=>{this.disconnected||(this.emitError(bf.Network,"Lost connection to server."),this.disconnect())}),a.on(bj.Close,()=>{this.disconnected||this._abort(bf.SocketClosed,"Underlying socket is already closed.")}),a}_initialize(a){this._id=a,this.socket.start(a,this._options.token)}_handleMessage(a){let b=a.type,c=a.payload,d=a.src;switch(b){case bk.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case bk.Error:this._abort(bf.ServerError,c.msg);break;case bk.IdTaken:this._abort(bf.UnavailableID,`ID "${this.id}" is taken`);break;case bk.InvalidKey:this._abort(bf.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case bk.Leave:a4.log(`Received leave message from ${d}`),this._cleanupPeer(d),this._connections.delete(d);break;case bk.Expire:this.emitError(bf.PeerUnavailable,`Could not connect to peer ${d}`);break;case bk.Offer:{let a=c.connectionId,b=this.getConnection(d,a);if(b&&(b.close(),a4.warn(`Offer received for existing Connection ID:${a}`)),c.type===be.Media){let e=new br(d,this,{connectionId:a,_payload:c,metadata:c.metadata});b=e,this._addConnection(d,b),this.emit("call",e)}else{if(c.type!==be.Data)return void a4.warn(`Received malformed connection type:${c.type}`);let e=new this._serializers[c.serialization](d,this,{connectionId:a,_payload:c,metadata:c.metadata,label:c.label,serialization:c.serialization,reliable:c.reliable});b=e,this._addConnection(d,b),this.emit("connection",e)}for(let c of this._getMessages(a))b.handleMessage(c);break}default:{if(!c)return void a4.warn(`You received a malformed message from ${d} of type ${b}`);let e=c.connectionId,f=this.getConnection(d,e);f&&f.peerConnection?f.handleMessage(a):e?this._storeMessage(e,a):a4.warn("You received an unrecognized message:",a)}}}_storeMessage(a,b){this._lostMessages.has(a)||this._lostMessages.set(a,[]),this._lostMessages.get(a).push(b)}_getMessages(a){let b=this._lostMessages.get(a);return b?(this._lostMessages.delete(a),b):[]}connect(a,b={}){if(b={serialization:"default",...b},this.disconnected){a4.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(bf.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}let c=new this._serializers[b.serialization](a,this,b);return this._addConnection(a,c),c}call(a,b,c={}){if(this.disconnected){a4.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(bf.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!b)return void a4.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");let d=new br(a,this,{...c,_stream:b});return this._addConnection(a,d),d}_addConnection(a,b){a4.log(`add connection ${b.type}:${b.connectionId} to peerId:${a}`),this._connections.has(a)||this._connections.set(a,[]),this._connections.get(a).push(b)}_removeConnection(a){let b=this._connections.get(a.peer);if(b){let c=b.indexOf(a);-1!==c&&b.splice(c,1)}this._lostMessages.delete(a.connectionId)}getConnection(a,b){let c=this._connections.get(a);if(!c)return null;for(let a of c)if(a.connectionId===b)return a;return null}_delayedAbort(a,b){setTimeout(()=>{this._abort(a,b)},0)}_abort(a,b){a4.error("Aborting!"),this.emitError(a,b),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(a4.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(let a of this._connections.keys())this._cleanupPeer(a),this._connections.delete(a);this.socket.removeAllListeners()}_cleanupPeer(a){let b=this._connections.get(a);if(b)for(let a of b)a.close()}disconnect(){if(this.disconnected)return;let a=this.id;a4.log(`Disconnect peer with ID:${a}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=a,this._id=null,this.emit("disconnected",a)}reconnect(){if(this.disconnected&&!this.destroyed)a4.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw Error("This peer cannot reconnect to the server. It has already been destroyed.");else if(this.disconnected||this.open)throw Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);else a4.error("In a hurry? We're still trying to make the initial connection!")}listAllPeers(a=a=>{}){this._api.listAllPeers().then(b=>a(b)).catch(a=>this._abort(bf.ServerError,a))}}class bz extends bt{constructor(a,b,c){super(a,b,{...c,reliable:!0}),this._CHUNK_SIZE=32768,this._splitStream=new TransformStream({transform:(a,b)=>{for(let c=0;c<a.length;c+=this._CHUNK_SIZE)b.enqueue(a.subarray(c,c+this._CHUNK_SIZE))}}),this._rawSendStream=new WritableStream({write:async(a,b)=>{let c=new Promise(a=>this.dataChannel.addEventListener("bufferedamountlow",a,{once:!0}));await (this.dataChannel.bufferedAmount<=bt.MAX_BUFFERED_AMOUNT-a.byteLength||c);try{this.dataChannel.send(a)}catch(a){a4.error(`DC#:${this.connectionId} Error when sending:`,a),b.error(a),this.close()}}}),this.writer=this._splitStream.writable.getWriter(),this._rawReadStream=new ReadableStream({start:a=>{this.once("open",()=>{this.dataChannel.addEventListener("message",b=>{a.enqueue(b.data)})})}}),this._splitStream.readable.pipeTo(this._rawSendStream)}_initializeDataChannel(a){super._initializeDataChannel(a),this.dataChannel.binaryType="arraybuffer",this.dataChannel.bufferedAmountLowThreshold=bt.MAX_BUFFERED_AMOUNT/2}}class bA extends bz{constructor(a,b,c){super(a,b,c),this.serialization="MsgPack",this._encoder=new aG,(async()=>{var a,b,c,d;for await(let e of(a=this._rawReadStream,void 0===b&&(b=aX),c=null!=(d=a)[Symbol.asyncIterator]?d:function(a){return aW(this,arguments,function(){var b,c,d,e;return aU(this,function(f){switch(f.label){case 0:b=a.getReader(),f.label=1;case 1:f.trys.push([1,,9,10]),f.label=2;case 2:return[4,aV(b.read())];case 3:if(d=(c=f.sent()).done,e=c.value,!d)return[3,5];return[4,aV(void 0)];case 4:return[2,f.sent()];case 5:if(null==e)throw Error("Assertion Failure: value must not be null nor undefined");return[4,aV(e)];case 6:return[4,f.sent()];case 7:return f.sent(),[3,2];case 8:return[3,10];case 9:return b.releaseLock(),[7];case 10:return[2]}})})}(d),new aT(b.extensionCodec,b.context,b.maxStrLength,b.maxBinLength,b.maxArrayLength,b.maxMapLength,b.maxExtLength).decodeStream(c))){if(e.__peerData?.type==="close")return void this.close();this.emit("data",e)}})()}_send(a){return this.writer.write(this._encoder.encode(a))}}class bB extends by{constructor(...a){super(...a),this._serializers={MsgPack:bA,default:bA}}}a.s(["BaseConnectionErrorType",()=>bg,"BufferedConnection",()=>bu,"ConnectionType",()=>be,"DataConnectionErrorType",()=>bh,"MsgPack",()=>bA,"MsgPackPeer",()=>bB,"Peer",()=>by,"PeerError",()=>bp,"PeerErrorType",()=>bf,"SerializationType",()=>bi,"ServerMessageType",()=>bk,"SocketEventType",()=>bj,"StreamConnection",()=>bz,"default",()=>by,"util",()=>a3],36281)}];

//# sourceMappingURL=5eb52_2e90d86c._.js.map